---
title: "**Contaminación y muerte prenatal**"
author: "Alvar Martínez e Iván Mamolar"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 5
---
<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


* [Repositorio de GitHub](https://github.com/ivanmr200/seminario_fuentes) 


## **Introducción**


La **mortalidad prenatal** o **mortalidad fetal tardía** se refiere a aquellos bebés que fallecen pasadas las 28 semanas de embarazo (a partir del séptimo mes) y que no llegan a término.
Las pricipales causas son las complicaciones que surgen durante el embarazo ya sean por infecciones como sífilis o VIH, otros tipos de anomalías maternas, como diabetes o hipertensión o anomalías durante el embarazo, o hábitos perjudiciales como el consumo de tabaco o el alcohol.

Además de estos factores, las condiciones ambientales pueden tener un efecto negativo en el embarazo. Estudios sugieren que la presencia de contaminantes en el aire pueden causar complicaciones en el embarazo e incluso aumentar la probabilidad de partos prematuros, así como la exposición al ruido puede tener efectos adversos para el embarazo pudiendo llegar a afectar a la mortalidad prenatal. 

En este seminario, vamos a tratar de demostrar si estos estudios se cumplen en las distintas comunidades autónomas españolas, analizando la relación que hay entre la **calidad del aire** y la **contaminación acústica** con la mortalidad prenatal.

![](./Input/IMAGES/muerteprenatal.jpg)

## **Objetivos**

El objetivo principal es demostrar si la contaminación del aire y la exposición al ruido pueden estar asociados con el número de casos de mortalidad fetal, a través de:

  - Analizar la concentración de PM 2.5 y PM 10 en el aire por comunidad autónoma.
  - Estudiar la relación entre la calidad del aire y mortalidad prenatal.
  - Analizar el porcentaje de población afectada por exceso de ruido en cada comunidad autónoma.
  - Estudiar la relación entre el exceso de ruido y mortalidad prenatal.



## **Metodología**

Los datos que vamos a utilizar han sido encontrados en la página oficial del Instituto Nacional de Estadística (INE) en el que se pueden encontrar una gran cantidad de datos de diferentes formatos como XLS, csv, JSON ... En nuestro caso los datos sobre mortalidad prenatal y contaminación son de fromato csv y JSON y se encuentran en la carpeta `DATA` dentro de la carpeta `Input` del repositorio.

Para poder utilizar estos conjuntos de datos son necesarios importarlos, para ello utilizaremos las siguientes librerías:

```{r , eval = TRUE,message=FALSE, warning=FALSE}
# Datos con formato .csv:
library(readr)

#Datos con formato .json:
library(tidyverse)
library(rjson)
library(tidyjson)

#Visualizacion resultados:
library(DT)
library(ggplot2)
library(gifski)
library(gganimate)
library(plotly)
library(dplyr)
library(mapSpain)


```

### **Importación archivos**

Una vez cargadas las librerías se pueden importar los datos. 

#### Importación datos CSV:

En algunos de nuestros archivos csv, es necesario especificar el tipo de codificación que tienen, para que R pueda leer correctamente los caracteres especiales como *tildes* o *ñ*. En nuestro caso utilizan la codificacion *ISO 8859-1* que corresponde con el alfabeto español :

```{r , eval = TRUE,message=FALSE}

# Para conocer el tipo de codificación: 
encoding <- guess_encoding("Input/DATA/media_anual_PM2_5.csv")
print(encoding)

```

```{r , eval = TRUE,message=FALSE}

PM2_media <- read_delim("Input/DATA/media_anual_PM2_5.csv", 
                        delim = ";", escape_double = FALSE, trim_ws = TRUE, 
                        locale = locale(encoding = "ISO-8859-1"))

PM10_media <- read_delim("Input/DATA/media_anual_PM10.csv", 
                        delim = ";", escape_double = FALSE, trim_ws = TRUE, 
                        locale = locale(encoding = "ISO-8859-1"))

RUIDO_media <- read_delim("Input/DATA/poblacion_sufre_ruidos.csv", 
                         delim = ";", escape_double = FALSE, trim_ws = TRUE)

```

#### Preparación datos csv

Los datos en los archivos csv estan distribuidos de tal forma que puede dificultar su comprensión y manejo, por ello vamos a modificarlos y ordenarlos.

El objetivo es conseguir que los años (*periodo*), que de forma predeterminada vienen en una única columna pasen a ser las columnas del dataframe y el nombre de las comunidades autónomas las filas. Además, eliminar aquellas columnas y filas que no son de nuestro interés.

##### <u>Concentración PM 2.5</u>

```{r , eval = TRUE,message=FALSE}
# Datos concentración anual PM 2.5
PM2_ccaa_media <- PM2_media %>%
  pivot_wider(names_from = periodo, values_from = Total)%>% 
  select(-`Total Nacional`)%>% #Eliminar columna Total Nacional
  slice(-1)%>%                    #Eliminar fila Total Nacional
  pivot_longer(
    cols = c("2022":"2004"),names_to = "Año",values_to = "PM2_5"
  )                    

datatable(PM2_ccaa_media)
```

##### <u>Concentración PM 10</u>

```{r , eval = TRUE,message=FALSE}
# Datos concentración anual PM 10
PM10_CCAA_media <- PM10_media %>%
  pivot_wider(names_from = periodo, values_from = Total)%>%
  select(-`Total Nacional`)%>%
  slice(-1)%>%
  pivot_longer(names_to = "Año", values_to = "PM10", cols = c("2022":"2004"))

datatable(PM10_CCAA_media)
```
##### <u>Población afectada por ruido</u>

```{r , eval = TRUE,message=FALSE}
#Datos población afectada por ruidos
RUIDO_CCAA_media <- RUIDO_media %>%
  pivot_wider(names_from = periodo, values_from = Total)%>%
  select(-`Total Nacional`)%>%
  slice(-1) %>%
  pivot_longer(names_to = "Año", values_to = "Ruido_dec", cols = c("2020":"2004"))

```

El nombre de las Comunidades Autónomas en los archivos csv aparecen con un índice que en nuestro caso vamos a eliminar ya que no lo utilizaremos y nos dificulta el tratamiento de las tablas.

*(En las tablas referentes a contaminación, se cambiará más adelante)*

En el caso del ruido: 

```{r , eval = TRUE,message=FALSE}
RUIDO_CCAA <- 
  RUIDO_CCAA_media %>%
  mutate(Comunidades_Autonomas = case_when(
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "01 Andalucía" ~ "Andalucía",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "02 Aragón" ~ "Aragón",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "03 Asturias, Principado de" ~ "Asturias, Principado de",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "04 Balears, Illes" ~ "Balears, Illes",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "05 Canarias" ~ "Canarias",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "06 Cantabria" ~ "Cantabria",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "07 Castilla y León" ~ "Castilla y León",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "08 Castilla - La Mancha" ~ "Castilla - La Mancha",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "09 Cataluña" ~ "Cataluña",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "10 Comunitat Valenciana" ~ "Comunitat Valenciana",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "11 Extremadura" ~ "Extremadura",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "12 Galicia" ~ "Galicia",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "13 Madrid, Comunidad de" ~ "Madrid, Comunidad de",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "14 Murcia, Región de" ~ "Murcia, Región de",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "15 Navarra, Comunidad Foral de" ~ "Navarra, Comunidad Foral de",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "16 País Vasco" ~ "País Vasco",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "17 Rioja, La" ~ "Rioja, La",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "18 Ceuta" ~ "Ceuta",
    RUIDO_CCAA_media$`Comunidades y Ciudades Autónomas`== "19 Melilla" ~ "Melilla",
    ))%>%
  mutate(Ruido = Ruido_dec/10)%>%
  select(Comunidades_Autonomas, everything())%>%
  select(-`Comunidades y Ciudades Autónomas`)%>%
  select(-Ruido_dec)

datatable(RUIDO_CCAA)

```

#### **Importación datos JSON:**

```{r , eval = TRUE,message=FALSE, warning=FALSE}

mort_prenatal <- fromJSON(file = "INPUT/DATA/mortalidad_prenatal_total.json")

mort_prenatal %>% 
  spread_all()

```

#### Preparación archivos .json

Una vez que hemos importado el archivo json, analizamos los tipos de los atributos que lo forman para quedarnos con aquellos de tipo *array* que son  los que contienen la información que queremos:

```{r , eval = TRUE,message=FALSE}

mort_prenatal %>% 
  gather_object %>% 
  json_types %>% 
  count(name, type)

```
En nuestro caso queremos estudiar la mortalidad prenatal tanto en hombres como en mujeres, para ello filtramos eliminando las columnas de hombres y mujeres quedándonos con las de ambos sexos:


```{r , eval = TRUE,message=FALSE}

filter <- c()
for (i in 1:60){
  filter <- append(filter, mort_prenatal[[i]]$MetaData[[4]]$Nombre == "Ambos sexos")
}
elim = 0
for (i in 1:60){
  if(!filter[i]){
    mort_prenatal[[i-elim]] <- NULL
    elim <- elim + 1
  }
}

```

Analizamos en profundidad el contenido de cada array y obtenemos lo siguiente:

- *Array Data*: se encuentran los valores de todos los años y sus respectivos valores de tasa de mortalidad prenatal

```{r , eval = TRUE,message=FALSE}

#VALORES DE LOS AÑOS A PARTIR DE 2004 Y VALORES MORTALIDAD
mort_valores_prenatal <-
  mort_prenatal %>%
  enter_object(Data) %>%
  gather_array %>%
  spread_all %>%
  select(Anyo, Valor, document.id)%>% 
  filter(Anyo >=2004)

```

- *Array Metadata*: están los nombres de las comunidades autónomas y clasficación por sexos

```{r , eval = TRUE,message=FALSE}

mort2_CCAA_prenatal <- mort_prenatal %>%
  enter_object(MetaData) %>%
  gather_array %>%
  spread_all %>%
  select(Nombre, document.id, T3_Variable) %>%
  filter(Nombre == "Andalucía" | Nombre == "Aragón" | Nombre == "Asturias, Principado de" |
           Nombre == "Balears, Illes" | Nombre == "Canarias" | Nombre == "Cantabria" |
           Nombre == "Castilla y León" | Nombre == "Castilla - La Mancha" | Nombre == "Cataluña" |
           Nombre == "Comunitat Valenciana" | Nombre == "Extremadura" | Nombre == "Galicia" |
           Nombre == "Madrid, Comunidad de" | Nombre == "Murcia, Región de" | Nombre == "Navarra, Comunidad Foral de" |
           Nombre == "País Vasco" | Nombre == "Rioja, La" | Nombre == "Ceuta" | Nombre == "Melilla") 

```

Para obtener la tabla con todos los datos bien estructurados y organizados es necesario hacer join entre los datos de ambos arrays:

```{r , eval = TRUE,message=FALSE}
#Join:
JOIN_mort_prenatal <-
  mort_valores_prenatal %>% 
  select(c("Anyo", "Valor", "document.id")) %>%
  full_join(x = ., 
            y = mort2_CCAA_prenatal %>% 
              select(c("Nombre", "document.id")),
            by = c("document.id") )
```

##### <u>Mortalidad fetal</u>
```{r , eval = TRUE,message=FALSE}

mortalidad <- JOIN_mort_prenatal %>%
  select(Nombre, Anyo, Valor)%>%
  pivot_wider(names_from = Anyo, values_from = Valor)%>% #Hacer que filas = CCAA y columnas = años
  slice(-1)%>%#Eliminar datos Total Nacional
  pivot_longer(names_to = "Año", values_to = "Mortalidad", cols = c("2022":"2004"))%>%
  rename(Comunidades_Autonomas = "Nombre")
  
datatable(mortalidad)

```


## **Mortalidad fetal tardía**

El objetivo principal es demostrar si existe alguna relación entre la mortalidad fetal tardía o mortalidad prenatal con distintos tipos de contaminación del ambiente, ya sea por contaminación atmosférica (PM) o acústica (Ruido).

Para ponernos en contexto, vamos a analizar el número de defunciones fetales por cada mil nacidos:

```{r , echo= FALSE, eval = TRUE,message=FALSE}
grafico_mort <- ggplot(mortalidad, aes(x = Año, y = Mortalidad, color = Comunidades_Autonomas, group = Comunidades_Autonomas)) + 
  geom_line(aes(x = Año, y = Mortalidad, color = Comunidades_Autonomas, group = Comunidades_Autonomas)) +  
  geom_point(aes(x = Año, y = Mortalidad, color = Comunidades_Autonomas, group = Comunidades_Autonomas)) +  
  labs(
    title = "Mortalidad Prenatal por Comunidad Autónoma",
    x = "Año",
    y = "Mortalidad Prenatal (por 1,000 nacidos vivos)",
    color = "Comunidad Autónoma") +
  theme_minimal()+
  theme(legend.position = "bottom")

ggplotly(grafico_mort)
```


###### **Conclusiones**

Se observa que hay una gran diferencia en la evolución de las tasas de mortalidad prenatal dependiendo de la Comunidad Autónoma, destancando grandes tasas en Ceuta, Melilla y La Rioja.

Las causas puede ser numerosas, ya sea por causas económicas, inaccesibilidad sanitaria o la calidad de la sanidad, entre otras. A partir de estos datos, vamos a tratar de demostrar si entre estas causas pueden estar la calidad del aire, analizando la concentración de particulas PM en suspensión, o la contaminación acústica


### **Relación con contaminantes atmosféricos**

En este apartado se estudiará la evolución de la concentración media de PM (2.5 y 10) en el aire a lo largo de los años en cada comunidad autónoma y su posible relación con el número de muertes fetales tardías.

#### - **Concentración contaminantes en el aire por CCAA**

A continuación relacionaremos las dos tablas de contaminación con datos de particulas de tamaño 2.5 y 10, obteniendo un valor medio entre las partículas PM2.5 y PM10, para posteriormente hacer la unión con la mortalidad y analizar si existe alguna correlación entre ellas.

```{r , eval = TRUE,message=FALSE, warning=FALSE}



# Reemplazar comas por puntos decimales 
PM2_ccaa_media <- PM2_ccaa_media %>%
  mutate(PM2_5 = as.numeric(gsub(",", ".", as.character(PM2_5))))

PM10_CCAA_media <- PM10_CCAA_media %>%
  mutate(PM10 = as.numeric(gsub(",", ".", as.character(PM10))))



# Unir las tablas por "Comunidades y Ciudades Autónomas" y "año"
calidad_aire <- PM2_ccaa_media %>%
  inner_join(PM10_CCAA_media, by = c("Comunidades y Ciudades Autónomas", "Año"))

# Calcular la media para cada comunidad y año, ignorando los valores NA
tabla_aire <- calidad_aire %>%
  group_by(`Comunidades y Ciudades Autónomas`, Año) %>%
  summarize(
    media_PM = mean(c(PM2_5, PM10), na.rm = TRUE),.groups = "drop") # Media de PM2.5 y PM10 por grupo

```

Cambio de nombre de atributo *Comunidades y Ciudades Autónomas*
```{r , eval = TRUE,message=FALSE, warning=FALSE}
media_calidad_aire <- 
  tabla_aire %>%
  mutate(Comunidades_Autonomas = case_when(
    tabla_aire$`Comunidades y Ciudades Autónomas`== "01 Andalucía" ~ "Andalucía",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "02 Aragón" ~ "Aragón",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "03 Asturias, Principado de" ~ "Asturias, Principado de",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "04 Balears, Illes" ~ "Balears, Illes",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "05 Canarias" ~ "Canarias",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "06 Cantabria" ~ "Cantabria",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "07 Castilla y León" ~ "Castilla y León",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "08 Castilla - La Mancha" ~ "Castilla - La Mancha",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "09 Cataluña" ~ "Cataluña",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "10 Comunitat Valenciana" ~ "Comunitat Valenciana",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "11 Extremadura" ~ "Extremadura",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "12 Galicia" ~ "Galicia",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "13 Madrid, Comunidad de" ~ "Madrid, Comunidad de",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "14 Murcia, Región de" ~ "Murcia, Región de",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "15 Navarra, Comunidad Foral de" ~ "Navarra, Comunidad Foral de",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "16 País Vasco" ~ "País Vasco",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "17 Rioja, La" ~ "Rioja, La",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "18 Ceuta" ~ "Ceuta",
    tabla_aire$`Comunidades y Ciudades Autónomas`== "19 Melilla" ~ "Melilla",
    ))%>%
  select(Comunidades_Autonomas, everything())%>%
  select(-`Comunidades y Ciudades Autónomas`)
  

# Ver los resultados de la media
datatable(media_calidad_aire)


```
A partir de la tabla anterior, se puede visualizar la evolución de la concentración de particulas en el aire, siendo las comunidades autónomas coloreadas con un color más oscuro las que tienen mayor concentración de PM:

```{r , echo = FALSE, eval = TRUE,message=FALSE, warning=FALSE}

datos <- media_calidad_aire %>%
  mutate(
    Comunidades_Autonomas = gsub("^\\d+ ", "", Comunidades_Autonomas) %>% trimws(),
    valor = as.numeric(gsub(",", ".", media_PM)),
    Año = as.integer(Año)
  )

ccaa_sf <- esp_get_ccaa() %>%
  left_join(
    mapSpain::esp_codelist %>% select(ine.ccaa.name, codauto) %>%
      rename(Comunidades_Autonomas = ine.ccaa.name) %>%
      distinct(),
    by = "codauto"
  ) %>%
  left_join(datos, by = "Comunidades_Autonomas") %>%
  mutate(valor = replace_na(valor, 0))

grafico_animado <- ggplot(ccaa_sf) +
  geom_sf(aes(fill = valor), color = "grey70", linewidth = .3) +
  geom_sf(data = esp_get_can_box(), color = "grey70") +
  scale_fill_gradientn(
    colors = hcl.colors(10, "Blues", rev = TRUE),
    n.breaks = 10,
    guide = guide_legend(title = "Valor medio PM", position = "inside")
  ) +
  theme_void() +
  theme(legend.position = c(0.1, 0.6)) +
  labs(title = "Valor medio PM 2.5 y PM10 en el aire | Año: {frame_time}", fill = "Valor medio PM") +
  transition_time(Año) +
  ease_aes("linear")

grafico_animado_contaminacion <- animate(grafico_animado, nframes = 85, fps = 4)

grafico_animado_contaminacion
```
En el siguiente gráfico se muestra la misma información pero de una forma fija y puede ayudar a ver mejor las diferencias entre las comunidades autónomas

```{r ,echo = FALSE, eval = TRUE,message=FALSE}
graf_PM <- ggplot(media_calidad_aire, aes(x = Año, y = media_PM, color = Comunidades_Autonomas, group = Comunidades_Autonomas)) +
  geom_point(aes(x = Año, y = media_PM, color = Comunidades_Autonomas, group = Comunidades_Autonomas)) +
  geom_line(aes(x = Año, y = media_PM, color = Comunidades_Autonomas, group = Comunidades_Autonomas))+
  labs(title = "Concentración PM en el aire por Comunidad Autónoma y Año", 
       x = "Año", 
       y = "Media PM",
       color = "CCAA") +
  theme_minimal() +
  theme(legend.position = "bottom")

ggplotly(graf_PM)

```


###### **Conclusiones**:

La concentración media de partículas en suspensión PM 2,5 y PM 10 parece seguir un comportamiento similar en todas las comunidades autónomas obteniendose unos valores similares en cada uno de ellos en estos últimos años.

Sin embargo, si analizamos los primeros años desde 2004 hasta 2008, estos valores medios tienen valores muchos más altos, alcanzando el máximo en Aragón. Es notable como a partir del **2008** dichos valores descienden de forma drastica. 
Investigando, hemos llegado a la conclusión de que esa bajada tan pronunciada es debido a la aprobación de la **Directiva 2008/50/CE**, con la que se impusieron regulaciones más estrictas para nuevos contaminantes, como son en este caso las particulas PM 2,5 y PM10, con el objetivo de mejorar la calidad del aire en la Unión Europea.



#### - **Relación contaminación/mortalidad prenatal**

Ahora relacionaremos la tabla anterior con la tabla que contiene datos de mortalidad prenatal para poder estudiar su posible relación.

```{r , eval = TRUE,message=FALSE}

mortalidad_aire <-
  left_join(x = media_calidad_aire, y = mortalidad, 
            by = c("Comunidades_Autonomas", "Año"))
  
datatable(mortalidad_aire)

```

Una vez obtenida la tabla con los datos de concentración media de PM y de mortalidad prenatal por año y comunidad autónomas podemos ver si existe alguna relación a partir de los siguientes gráficos.

```{r, echo = FALSE, message=FALSE, warning=FALSE, warning=FALSE}

# Asegurar que Año sea numérico
mortalidad_aire$Año <- as.integer(mortalidad_aire$Año)

p <- ggplot(mortalidad_aire, aes(x = media_PM, y = Mortalidad, colour = Comunidades_Autonomas)) +
  geom_point(aes(colour = factor(Comunidades_Autonomas)),alpha = 0.7, size = 4, show.legend = TRUE) +  
  scale_color_viridis_d() +
  facet_wrap(~ Comunidades_Autonomas) +
  labs(
    title = 'Año: {frame_time}',
    x = 'Concentración media de PM (µg/m³)',
    y = 'Mortalidad prenatal (por mil)',
    color = "Comunidad Autónoma"
  ) +
  theme_minimal() +
  transition_time(Año) +
  ease_aes('linear')

grafico_animado <- animate(p, nframes = 85, fps = 10)
grafico_animado
```

Para poder realizar un analisis más concreto y enfocado en cada omunidad se pueden seleccionar entre las distintas pestañas la Comunidad Autónoma deseada


##### Selecciona Comunidad Autónoma{.tabset .tabset-fade .tabset-pills .unnumbered}
###### Andalucía
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_and <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Andalucía")
  
ggplot(data_and, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Andalucía",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Aragón
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_arg <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Aragón")

ggplot(data_arg, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Aragón",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Baleares
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_bal <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Balears, Illes")

ggplot(data_bal, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en I.Baleares",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Canarias
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_can <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Canarias")

ggplot(data_can, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Canarias",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Cantabria
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_cant <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Cantabria")

ggplot(data_cant, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Cantabria",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Castilla y León
```{r, echo = FALSE, message=FALSE, warning=FALSE}
# Filtrar solo los datos de Castilla y León
data_cyl <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Castilla y León")
  

# Crear gráfico de dispersión para Castilla y León
ggplot(data_cyl, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Castilla y León",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Castilla - La Mancha
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_clm <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Castilla - La Mancha")
  
ggplot(data_clm, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Castilla - La Mancha",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Cataluña
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_ctl <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Cataluña")
  
ggplot(data_ctl, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Cataluña",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Comunitat Valenciana
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_vlc <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Comunitat Valenciana")
  
ggplot(data_vlc, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Comunitat Valenciana",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Extremadura
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_ext <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Extremadura")
  
ggplot(data_ext, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Extremadura",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Galicia
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_gal <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Galicia")
  
ggplot(data_gal, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Galicia",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Madrid
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_mad <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Madrid, Comunidad de")
  
ggplot(data_mad, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Madrid",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Murcia
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_mur <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Murcia, Región de")
  
ggplot(data_mur, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Murcia",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Navarra
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_nav <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Navarra, Comunidad Foral de")
  
ggplot(data_nav, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Navarra",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Pais Vasco
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_pv <- mortalidad_aire %>% filter(Comunidades_Autonomas == "País Vasco")
  
ggplot(data_pv, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Pais Vasco",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### La Rioja
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_rioj <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Rioja, La")
  
ggplot(data_rioj, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en La Rioja",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Ceuta
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_ceu <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Ceuta")
  
ggplot(data_ceu, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Ceuta",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Melilla
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_mel <- mortalidad_aire %>% filter(Comunidades_Autonomas == "Melilla")
  
ggplot(data_mel, aes(x = media_PM, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la concentración de PM y la mortalidad infantil en Melilla",
       x = "Concentración de PM (µg/m³)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```



##### Conclusiones:







### **Relación con contaminantes acústicos**

En este apartado se estudiará la evolución de la población afectada por ruidos externos a lo largo de los años en cada comunidad autónoma y su posible relación con el número de muertes prenatales.


#### - **Población afectada por ruido**

El siguiente grafico muestra la evolución de la población afectada por ruido externo en cada Comunidad Autonoma.

```{r , echo = FALSE, eval = TRUE,message=FALSE, warning=FALSE}
#MAPA

datos <- RUIDO_CCAA %>%
  mutate(
    Comunidades_Autonomas = gsub("^\\d+ ", "", Comunidades_Autonomas) %>% trimws(),
    valor = as.numeric(gsub(",", ".", Ruido)),
    Año = as.integer(Año)
  )


ccaa_sf <- esp_get_ccaa() %>%
  left_join(
    mapSpain::esp_codelist %>% select(ine.ccaa.name, codauto) %>%
      rename(Comunidades_Autonomas = ine.ccaa.name) %>%
      distinct(),
    by = "codauto"
  ) %>%
  left_join(datos, by = "Comunidades_Autonomas") %>%
  mutate(valor = replace_na(valor, 0))


grafico_animado <- ggplot(ccaa_sf) +
  geom_sf(aes(fill = valor), color = "grey70", linewidth = .3) +
  geom_sf(data = esp_get_can_box(), color = "grey70") +
  scale_fill_gradientn(
    colors = hcl.colors(10, "Blues", rev = TRUE),
    n.breaks = 10,
    guide = guide_legend(title = "Población afectada por ruido (%)", position = "inside")
  ) +
  theme_void() +
  theme(legend.position = c(0.1, 0.6)) +
  labs(title = "Población afectada por ruido | Año: {frame_time}", fill = "% población afectada por ruido") +
  transition_time(Año) +
  ease_aes("linear")

grafico_animado_ruido <- animate(grafico_animado, nframes = 85, fps = 3)

grafico_animado_ruido
```


```{r ,echo = FALSE, eval = TRUE,message=FALSE, warning=FALSE}
graf_ru <- ggplot(RUIDO_CCAA, aes(x = Año, y = Ruido, color = Comunidades_Autonomas, group = Comunidades_Autonomas)) +
  geom_point() +
  geom_line()+
  labs(title = "Población afectada por ruido por Comunidad Autónoma y Año", 
       x = "Año", 
       y = "Ruido (%)",
       color = "CCAA") +
  theme_minimal() +
  theme(legend.position = "bottom")

ggplotly(graf_ru)

```


##### **Conclusiones**

A partir del gráfico obtenemos que las comunidades autonomas cuya población es más afectada por el ruido son Ceuta y Melilla, seguida de Comunidad Valenciana.

Estos resultados contradicen la idea que teníamos sobre que seguramente aquellas comunidades con ciudades más grandes, como Madrid o Barcelona, al tener un número más grande de habitantes podrían estar más afectados por ruidos ya que hay más "movimiento".


#### - **Relación entre ruido/mortalidad prenatal**


A continuación haremos lo mismo pero en este caso, uniendo la tabla de mortalidad prenatal junto con la de ruido ambiente.
```{r , eval = TRUE,message=FALSE}


mortalidad_RUIDO <- 
  left_join(x = RUIDO_CCAA, y = mortalidad, by = c("Comunidades_Autonomas", "Año"))
            
datatable(mortalidad_RUIDO)


```
```{r, echo = FALSE, message=FALSE, warning=FALSE}

# Asegurar que Año sea numérico
mortalidad_RUIDO$Año <- as.integer(mortalidad_RUIDO$Año)

p <- ggplot(mortalidad_RUIDO, aes(x = Ruido, y = Mortalidad, colour = Comunidades_Autonomas)) +
  geom_point(aes(colour = factor(Comunidades_Autonomas)),alpha = 0.7, size = 4, show.legend = TRUE) +  
  scale_color_viridis_d() +
  facet_wrap(~ Comunidades_Autonomas) +
  labs(
    title = 'Año: {frame_time}',
    x = 'Población afectada por Ruido (%)',
    y = 'Mortalidad prenatal',
    color = "Comunidad Autónoma"
  ) +
  theme_minimal() +
  transition_time(Año) +
  ease_aes('linear')

grafico_animado_ruido <- animate(p, nframes = 85, fps = 10)
grafico_animado_ruido
```




Para poder realizar un analisis más concreto de cada comunidad se pueden seleccionar las distintas pestañas

##### Selecciona Comunidad Autónoma{.tabset .tabset-fade .tabset-pills .unnumbered}
###### Andalucía
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_and_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Andalucía")
  
ggplot(data_and_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Andalucía",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Aragón
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_arg_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Aragón")

ggplot(data_arg_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Aragón",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Baleares
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_bal_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Balears, Illes")

ggplot(data_bal_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en I.Baleares",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Canarias
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_can_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Canarias")

ggplot(data_can_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Canarias",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Cantabria
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_cant_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Cantabria")

ggplot(data_cant_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Cantabria",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal",
       color = "Año") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Castilla y León
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_cyl_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Castilla y León")

ggplot(data_cyl_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Castilla y León",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Castilla - La Mancha
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_clm_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Castilla - La Mancha")
  
ggplot(data_clm_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Castilla - La Mancha",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Cataluña
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_ctl_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Cataluña")
  
ggplot(data_ctl_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Cataluña",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Comunitat Valenciana
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_vlc_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Comunitat Valenciana")
  
ggplot(data_vlc_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Comunitat Valenciana",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Extremadura
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_ext_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Extremadura")
  
ggplot(data_ext_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Extremadura",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Galicia
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_gal_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Galicia")
  
ggplot(data_gal_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en en Galicia",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Madrid
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_mad_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Madrid, Comunidad de")
  
ggplot(data_mad_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Madrid",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Murcia
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_mur_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Murcia, Región de")
  
ggplot(data_mur_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Murcia",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Navarra
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_nav_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Navarra, Comunidad Foral de")
  
ggplot(data_nav_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Navarra",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Pais Vasco
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_pv_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "País Vasco")
  
ggplot(data_pv_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Pais Vasco",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### La Rioja
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_rioj_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Rioja, La")
  
ggplot(data_rioj_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en La Rioja",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Ceuta
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_ceu_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Ceuta")
  
ggplot(data_ceu_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Ceuta",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```

###### Melilla
```{r, echo = FALSE, message=FALSE, warning=FALSE}

data_mel_ru <- mortalidad_RUIDO %>% filter(Comunidades_Autonomas == "Melilla")
  
ggplot(data_mel_ru, aes(x = Ruido, y = Mortalidad)) +
  geom_point(aes(color = factor(Año))) +                
  geom_smooth(method = "lm", color = "red", se = TRUE) + 
  labs(title = "Relación entre la población afectada por ruido y la mortalidad prenatal en Melilla",
       x = "Población afectada por ruido (%)",
       y = "Tasa de mortalidad Prenatal") +
  theme_minimal()+
  theme(legend.position = "bottom")
```


##### Conclusiones

Dependiendo de la Comunidad Autónoma que quieras elegir, presenta un comportamiento distinto. Por ejemplo, 




## Conclusión General:
